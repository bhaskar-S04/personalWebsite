<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body {font-family: Arial; padding: 20px;}
        table {border-collapse: collapse; width: 100%;}
        th, td {border: 1px solid #ccc; padding: 8px;}
        th {background-color: #f4f4f4;}
        #logout {margin-top: 20px;}
    </style>
</head>
<body>
    <h2>Admin Dashboard</h2>
    <p id="status"></p>

    <table id="messageTable">
        <thread>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Message</th>
                <th>Received</th>
            </tr>
        </thread>
        <tbody></tbody>
    </table>

    <button id="logout">Logout</button>

    <script>
        if (!localStorage.getItem("adminLogin")) {
            window.location.href="/admin/login.html";
        }


        fetch("http://localhost:3000/messages")
        .then(res => res.json())
        .then(data => {
            const tableBody = document.querySelector("#messageTable tbody");
            if(data.length === 0) {
                document.getElementById("status").textContent = "No messages found.";
            }
            data.forEach((msg, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                <td>${index + 1}</td>
                <td>${msg.name}</td>
                <td>${msg.email}</td>
                <td>${msg.message}</td>
                <td>${msg.created_at || "-"}</td>
                `;
                tableBody.appendChild(row);
            });
        })
        .catch(err=> {
            console.error("Failed to fetch messages,", err);
            document.getElementById("status").textContent = "Failed to load messages.";
        });


        document.getElementById("logout").addEventListener("click", ()=> {
            localStorage.removeItem("adminLogin");
            window.location.href = "/admin/login.html";
        });
    </script>
</body>
</html>